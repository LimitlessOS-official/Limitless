#include "dev.h"

#define MAX_DEV 128
static device_t* g_devs[MAX_DEV];
static dev_hotplug_cb g_hotplug = NULL;

int dev_register(device_t* d) {
    for (int i=0;i<MAX_DEV;i++) {
        if (!g_devs[i]) { g_devs[i] = d; if (g_hotplug) g_hotplug(d, 1); return 0; }
    }
    return K_EBUSY;
}

void dev_enumerate(void (*cb)(device_t*, void*), void* user) {
    for (int i=0;i<MAX_DEV;i++) if (g_devs[i] && cb) cb(g_devs[i], user);
}

void dev_set_hotplug(dev_hotplug_cb cb) { g_hotplug = cb; }